{% extends 'base.html' %}
{% load i18n %}
{% load staticfiles %}

{% block title %} Search {% endblock %}

{% block body_block %}
    <div> 
    <h3>Browse {{btype}}</h3>
    {% if aggs_list %}
        <div class="list-group">

            <!-- <form id="browse_filter_form" method="post" action="/en/jprints/browse/{{btype}}/" > -->
            <!-- <form id="browse_filter_form" method="post" action="{% url "core:browse_top" %}{{btype}}/" >  -->
            <form id="browse_filter_form" method="post" action="{% url "core:browse" btype %}" >
                {% csrf_token %}
                {% if 'item_type' in aggs_list %}
                    {% trans "Item Type" %}: 
                    {% for key, val in aggs_list.item_type.items %}
                        <label class="checkbox-inline">
                            <input type="checkbox" name="item_type_{{key}}" onclick="this.form.submit();" 
                                 {% if val.selected == 1 %} checked="checked" {% endif %}
                                value="item_type_{{key}}">{% trans val.label %} ({{val.count}})</label>
                    {% endfor %}
                {% endif %}

                {% if 'pub_status' in aggs_list %}
                    <br/>{% trans "Publication Status" %}: 
                    {% for key, val in aggs_list.pub_status.items %}
                        <label class="checkbox-inline">
                            <input type="checkbox" name="pub_status_{{key}}" onclick="this.form.submit();"
                                 {% if val.selected == 1 %} checked="checked" {% endif %}
                                value="pub_status_{{key}}">{% trans val.label %} ({{val.count}})</label>
                    {% endfor %}
                {% endif %}

                {% if 'status' in aggs_list %}
                    <br/>{% trans "Item Status" %}:
                     {% for key, val in aggs_list.status.items %}
                        <label class="checkbox-inline">
                            <input type="checkbox" name="status_{{key}}" onclick="this.form.submit();" 
                                 {% if val.selected == 1 %} checked="checked" {% endif %}
                                value="status_{{key}}">{% trans val.label %} ({{val.count}})</label>
                    {% endfor %}
                {% endif %}

                {% if 'milestone' in aggs_list %}
                    <br/>{% trans "Year" %}:
                     {% for key, val in aggs_list.milestone.items %}
                        <label class="checkbox-inline">
                            <input type="checkbox" name="milestone_{{val.label}}" onclick="this.form.submit();"
                                 {% if val.selected == 1 %} checked="checked" {% endif %}
                                value="milestone_{{val.label}}">{{val.label }} ({{val.count}})</label>
                    {% endfor %}
                {% endif %}

                {% if 'user_org' in aggs_list %}
                    <h4>User Organisation</h4>
                {% endif %}
                {% if 'user_dept' in aggs_list %}
                    <h4>User Department</h4>
                {% endif %}
                {% if 'user_type' in aggs_list %}
                    <h4>User Type</h4>
                {% endif %}
                {% if 'family' in aggs_list %}
                    <h4>Family Name</h4>
                {% endif %}
                {% if 'first_char' in aggs_list %}
                    <h4>Alphabetic List</h4>
                {% endif %}

<!--
                {% for key, val in aggs_list.items %}
                    <h4>{{key}} - {{val}} agg</h4> 
                {% endfor %}
                <br/>
                <input type="submit" name="updatebrowse" value="Refresh" />
-->
            </form>

        </div>
    {% else %}
        <p>There are no aggs in this view</p>
    {% endif %}
 
    {% if result_list %}
        <div class="list-group">
        {% for result in result_list %}
            <div class="list-group-item">
            {% if result.type == "publication" %}
                <h4 class="list-group-item-heading">
                <a href="{% url 'publication:detail' result.id %}">
                    <img width="20px" height="20px" src="{% static 'images/' %}{{ result.obj.get_icon_name }}" alt="icon" /> {{ result.obj.get_search_citation }}</a>
                </h4> 
            {% elif result.type == "fulltext" %}
                <h4 class="list-group-item-heading">
                <a href="{% url 'publication:detail' result.obj.publication.id %}">
                    <img width="20px" height="20px" src="{% static 'images/' %}{{ result.obj.publication.get_icon_name }}" alt="icon" /> FULLTEXT {{ result.obj.publication.get_search_citation }}</a>
                </h4> 
 
            {% elif result.type == "person" %}
                <h4>
                    <a href="{% url 'core:detail' result.id %}">
                       <img width="20px" height="20px" src="{{ MEDIA_URL }}{{ result.obj.photo.name }}" alt="photo" /> {{ result.obj.get_search_citation }}
                    </a>
                </h4> ({{result.obj.orcid}})
                {% endif %}
                {% autoescape off %}
                {% if result.highlight_t %}
                   <p class="list-group-item-text">Found in title: {{ result.highlight_t }}</p>
                {% endif %}
                {% if result.highlight_a %}
                   <p class="list-group-item-text">Found in abstract: {{ result.highlight_a }}</p>
                {% endif %}
                {% if result.highlight_ft %}
                   <p class="list-group-item-text">Found in text: {{ result.highlight_ft }}</p>
                {% endif %}
                {% if result.highlight_f %}
                   <p class="list-group-item-text">Found in family name: {{ result.highlight_f }}</p>
                {% endif %}
                {% if result.highlight_g %}
                   <p class="list-group-item-text">Found in given name: {{ result.highlight_g }}</p>
                {% endif %}
                {% if result.highlight_b %}
                   <p class="list-group-item-text">Found in fulltext: {{ result.highlight_b }}</p>
                {% endif %}
                {% if result.highlight_fn %}
                   <p class="list-group-item-text">Found in file name: {{ result.highlight_fn }}</p>
                {% endif %}
                {% if result.highlight_fd %}
                   <p class="list-group-item-text">Found in file description: {{ result.highlight_fd }}</p>
                {% endif %}




                {% endautoescape %}
            </div>
        {% endfor %}
        </div>
    {% else %}
        <p>There are currently no items in this view</p>
    {% endif %}
    </div>
{% endblock %}

